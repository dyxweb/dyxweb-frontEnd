## JSBridge
- 跨平台开发：JSBridge允许在混合应用中使用一套代码同时运行在不同的平台上。这意味着可以使用Web技术来开发应用的核心逻辑，并在需要时通过JSBridge调用原生功能，从而实现跨平台开发，提高开发效率。
- 原生功能扩展：使用JSBridge可以充分利用原生平台提供的功能和能力，例如访问硬件设备、调用系统API等。可以为应用添加更多丰富的功能，提升用户体验。
- 通信桥梁：JSBridge充当了Web应用和原生应用之间的通信桥梁。通过JSBridge可以在Web应用和原生应用之间进行双向通信，使两者能够互相调用和传递数据。
- 灵活性和扩展性：JSBridge提供了一种灵活和可扩展的方式来实现Web应用和原生应用之间的通信。开发人员可以根据应用的需求随时添加新的原生功能，并通过JSBridge在JavaScript中调用这些功能，从而实现应用的功能扩展和升级。
### Native向Web发送消息
- Native向Web发送消息基本原理是在WebView容器中动态地执行一段JS脚本，通常情况下是调用一个挂载在全局上下文的方法。
- Native端可以直接调用挂载在window上的全局方法并传入相应的函数执行参数，并且在函数执行结束后Native端可以直接拿到执行结果。
### Native向Web发送消息的调用顺序
1. Web端提前subscribe订阅事件(存储事件处理函数)。
2. 原生调用一个挂载在全局上下文的方法，此事件处理中emit发布事件，执行之前Web端subscribe订阅时存储的事件处理函数。
### Native向Web发送消息的实现方式
- WEB：全局挂载方法。
- iOS：evaluatingJavaScript。
- 安卓：两种方法类似，使用方法也类似。
  - 4.4以上：evaluatingJavaScript。
  - 4.4以下：loadUrl。
### Web向Native发送消息
- Web向Native发送消息基本原理是在WEB中某段JS代码的执行端上是可感知的，端上感知到WEB中的行为后根据相关约定进行处理。
### Web向Native发送消息的实现方式
- 跳转拦截(不选择)
  - 客户端无差别拦截所有请求，正常URL放行，符合约定协议的请求拦截，并做出对应的操作。
  - 同时发送多个请求会丢消息、URL有长度限制。
  - iOS和安卓都支持。
- 弹窗拦截(alert/confirm/prompt)
  - 无明显短板，支持同步返回数据。
  - 不支持直接传递对象，需要序列化数据，在高频/大数据量通信的场景可能有一些性能上的损耗。
  - iOS和安卓都支持。
- addJavascriptInterface注入(推荐)
  - 目前推荐的方案，具备JSContext注入的所有优点。
  - 没有参数的限制，可直接传对象，无需序列化。同时也支持同步返回结果。
  - 安卓4.2以上版本支持。
- JSContext注入(不推荐)
  - 能力强大，但是只有UIWebview支持。
  - 低版本iOS支持。
- MessageHandler注入(推荐)
  - 官方推荐的通信API，无需JSON化传数据，不丢消息，但不支持同步返回。
  - 高版本iOS支持。
### Web向Native发送消息的最佳方式
- iOS：推荐使用MessageHandler + 弹窗拦截拦截两个方案并存，同时实现异步和同步调用。
- 安卓：推荐使用addJavaScriptInterface。
### 拦截式
- WebView中发出的所有请求都是可以被Native容器感知到的，因此拦截式具体指的是Native拦截Web发出的URL请求，双方在此之前约定一个JSB请求格式，如果该请求是JSB则进行相应的处理，若不是则直接转发。
- Web端发出请求的方式非常多样，例如a标签、iframe.src、location.href、ajax等，但a标签需要用户手动触发，location.href可能会导致页面跳转，安卓端拦截ajax的能力有所欠缺，因此绝大多数拦截式实现方案均采用iframe来发送请求。
- 拦截式在双端都具有非常好的向下兼容性，曾经是最主流的JSB实现方案，但目前在高版本的系统中已经逐渐被淘汰。
### 拦截式劣势 
- 连续发送时可能会造成消息丢失(可以使用消息队列解决该问题)。
- URL字符串长度有限制。
- 性能一般，URLrequest创建请求有一定的耗时。
### 注入式
- 这种方式简单而直观，并且不存在参数长度限制和性能瓶颈等问题，目前主流的JSBridge SDK都将注入式方案作为优先选择。
### 拦截式 VS 注入式
| 方案 | 兼容性 | 性能 | 参数长度限制 |
| --- | --- | --- | --- |
| 拦截式 | 无兼容性问题	| 较差，安卓端尤为明显 | 有限制 |
| 注入式 | 安卓4.2+ 和 iOS 7+以上可用 |	较好 | 无 |
