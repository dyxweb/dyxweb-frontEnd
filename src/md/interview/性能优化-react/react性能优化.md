## React性能优化
> ‌React的更新机制是从状态变化的组件开始更新(不会从根组件开始触发更新)，然后递归更新整个组件树。

### react工作流
- React是声明式UI库，负责将数据转换为页面结构(虚拟DOM结构)后，再转换成真实DOM结构交给浏览器渲染。
- 当数据发生改变时，React会先进行调和(Reconciliation)阶段，调和阶段结束后立刻进入提交(Commit)阶段，提交阶段结束后新数据对应的页面才被展示出来。
#### 调和阶段
1. 计算目标虚拟DOM结构：计算出目标数据对应的虚拟DOM结构(类组件的render方法或函数组件自身)。
2. Diff过程：寻找将当前虚拟DOM结构修改为目标虚拟DOM结构的最优更新方案(Diff算法，会记录虚拟DOM的更新方式如Update、Mount、Unmount，为提交阶段做准备)。
#### 提交阶段
1. 更新真实DOM：将调和阶段记录的更新方式应用到真实DOM中。
2. 调用暴露给开发者的生命周期钩子方法。 
### Render过程
- 调和阶段中计算目标虚拟DOM结构的过程称为Render过程。
- 触发React组件的Render过程的方式
    1. State更新
    2. Props更新
    3. 父组件Render触发子组件Render过程。
    4. 组件依赖的上下文(context)发生变化
    5. forceUpdate强制更新
    6. 组件依赖的自定义hooks发生变化
### react底层优化机制
- 虚拟DOM + Diff算法高效的更新真实DOM。
- 升级fiber架构使得Diff过程可以被中断且恢复，fiber架构把Diff的工作过程时间分片，避免JS脚本执行时间过长导致页面掉帧、页面卡顿。
- 设计任务调度优先级更高效的更新，及时响应用户的操作。
### 优化策略
- 由于调和阶段的Diff过程和提交阶段的更新真实DOM都属于React的内部实现，开发者能提供的优化能力有限，仅有列表项使用key属性等少量优化技巧。
- 实际项目中大部分优化方式都集中在调和阶段计算目标虚拟DOM的过程。
