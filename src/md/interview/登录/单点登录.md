## 单点登录
### 同域下的SSO（主域名相同）
> 当百度网站存在两个相同主域名下的贴吧子系统tieba.baidu.com和网盘子系统pan.baidu.com时，以下为实现SSO的步骤：

1. 客户端：用户访问某个子系统时（例如tieba.baidu.com），如果没有登录，则跳转至SSO认证中心提供的登录页面进行登录。
2. 服务端：登录认证后，服务端把登录用户的信息存储于Session中，并且附加在响应头的Set-Cookie字段中，设置Cookie的Domain为.baidu.com。
3. 客户端：再次发送请求时，携带主域名Domain下的Cookie给服务器，此时服务端就可以通过该Cookie来验证登录状态了。
### 跨域下的SSO（主域名不同）
> 购物网站天猫tmall.com和淘宝taobao.com利用CAS（Central Authentication Service）中央授权服务只需要登录其中某一个系统，另外一个系统打开后就会默认登录。

![单点登录](./img/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95.png)
1. 客户端：开始访问系统A。
2. 系统A：发现用户未登录，重定向至CAS认证服务（sso.com），同时URL地址参数携带登录成功后回跳到系统A的页面链接（sso.com/login?redir…）。
3. CAS认证服务：发现请求Cookie中没有携带登录的票据凭证（TGC），所以CAS认证服务判定用户处于未登录状态，重定向用户页面至CAS的登录界面，用户在CAS的登录页面上进行登录操作。
4. 客户端：输入用户名密码进行CAS系统认证。
5. CAS认证服务：校验用户信息并且生成TGC放入自己的Session中，同时以Set-Cookie形式写入Domain为sso.co的域下，同时生成一个授权令牌ST（Service Ticket），然后重定向至系统A的地址，重定向的地址中包含生成的ST（重定向地址：www.taobao.com?token=ST-345678）
6. 系统A：拿着ST向CAS认证服务发送请求，CAS认证服务验证票据（ST）的有效性。验证成功后系统A服务器使用该票据（ST）创建与用户的会话，称为局部会话，返回受保护资源。
7. 客户端：开始访问系统B。
8. 系统B：发现用户未登录，重定向至CAS认证服务，并将自己的地址作为参数传递，并附上在sso.com域下的cookie值（第五步生成的TGC）。
9. CAS认证服务：CAS认证服务中心发现用户已登录，跳转回系统B的地址，并附上票据（ST）。
10. 系统B：拿着ST向CAS认证服务发送请求，CAS认证服务验证票据（ST）的有效性。验证成功后系统B服务器使用该票据（ST）创建与用户的会话，称为局部会话，返回受保护资源。
### CAS一般提供四个接口：
- /login：登录接口，用于登录到中央授权服务。
- /logout：登出接口，用于从中央授权服务中登出。
- /validate：用于验证用户是否登录中央授权服务。
- /serviceValidate：用于让各个Service验证用户是否登录中央授权服务。